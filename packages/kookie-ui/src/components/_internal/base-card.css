/**
 * Base Card Component Styles
 *
 * This file contains the foundational styling for the Card component in the
 * Kookie User Interface design system.
 *
 * ARCHITECTURE (matching base-button.css):
 * 1. Base styles: Layout, material system, pseudo-element setup
 * 2. Sizes: Responsive padding and border-radius
 * 3. Variant palettes: Each variant defines its color variables
 * 4. Shared state logic: Single set of hover/active/open selectors (outline, soft, surface)
 * 5. Border variants: Outline & surface border handling
 * 6. Ghost variant: Separate - applies styles to element, not ::before
 * 7. Classic variant: Separate - uses elevation and surface colors
 */

/* stylelint-disable selector-max-type */

/***************************************************************************************************
 *                                                                                                 *
 * BASE STYLES                                                                                     *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard {
  /* Material system - defaults to solid behavior */
  --material-blend: 100%;
  --material-alpha: 0;

  &:where([data-material='solid'], [data-panel-background='solid']) {
    --material-blend: 100%;
    --material-alpha: 0;
  }

  &:where([data-material='translucent'], [data-panel-background='translucent']) {
    --material-blend: 60%;
    --material-alpha: 1;
  }

  /* Layout */
  display: block;
  position: relative;
  overflow: hidden;
  box-sizing: border-box;
  border-radius: var(--base-card-border-radius);
  transition: var(--transition-card);
  contain: paint;

  /* Padding */
  padding-top: var(--base-card-padding-top);
  padding-right: var(--base-card-padding-right);
  padding-bottom: var(--base-card-padding-bottom);
  padding-left: var(--base-card-padding-left);

  /* Typography reset */
  font-family: var(--default-font-family);
  font-weight: var(--font-weight-normal);
  font-style: normal;
  text-align: start;

  /* Inset calculations */
  --inset-border-width: var(--base-card-border-width);
  --inset-border-radius: var(--base-card-border-radius);
  --inset-padding-top: calc(var(--base-card-padding-top) - var(--base-card-border-width));
  --inset-padding-right: calc(var(--base-card-padding-right) - var(--base-card-border-width));
  --inset-padding-bottom: calc(var(--base-card-padding-bottom) - var(--base-card-border-width));
  --inset-padding-left: calc(var(--base-card-padding-left) - var(--base-card-border-width));

  /*
   * Pseudo-element setup
   * ::before = background color (z-index: -1)
   * ::after = border on top of children
   */
  &::before,
  &::after {
    content: '';
    position: absolute;
    pointer-events: none;
    transition: inherit;
    border-radius: calc(var(--base-card-border-radius) - var(--base-card-border-width));
    inset: var(--base-card-border-width);
  }

  &::before {
    z-index: -1;
  }

  /* Backdrop-filter for ::before - applies to outline, soft, surface */
  :where([data-panel-background='translucent'], [data-material='translucent']) &::before {
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
  }

  &:where([data-material='solid'], [data-panel-background='solid'])::before {
    backdrop-filter: none;
  }

  &:where([data-material='translucent'], [data-panel-background='translucent'])::before {
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
  }

  /* Interactive scale - applies to all interactive cards */
  &:where(:any-link, button, label) {
    cursor: pointer;

    @media (hover: hover) {
      &:where(:hover:not([data-state='open'])) {
        scale: 1.01;
      }
    }

    &:where(:active:not([data-state='open'])) {
      scale: 0.98;
    }
  }

  /* Disable scale on Firefox (SVG rendering issues with transforms) */
  @supports (-moz-appearance: none) {
    &:where(:any-link, button, label) {
      &:where(:hover:not([data-state='open'])),
      &:where(:active:not([data-state='open'])) {
        scale: 1;
      }
    }
  }

  /* Disable scale on Windows (subpixel text re-rasterization causes flicker) */
  :where([data-os='windows']) &:where(:any-link, button, label) {
    &:where(:hover:not([data-state='open'])),
    &:where(:active:not([data-state='open'])) {
      scale: 1;
    }
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * SIZES                                                                                           *
 *                                                                                                 *
 ***************************************************************************************************/

@breakpoints {
  .rt-BaseCard {
    &:where(.rt-r-size-1) {
      --base-card-padding-top: var(--space-2);
      --base-card-padding-right: var(--space-2);
      --base-card-padding-bottom: var(--space-2);
      --base-card-padding-left: var(--space-2);
      --base-card-border-radius: min(var(--radius-5), calc(var(--radius-1) + var(--space-1)));
    }
    &:where(.rt-r-size-2) {
      --base-card-padding-top: var(--space-3);
      --base-card-padding-right: var(--space-3);
      --base-card-padding-bottom: var(--space-3);
      --base-card-padding-left: var(--space-3);
      --base-card-border-radius: min(var(--radius-6), calc(var(--radius-2) + var(--space-2)));
    }
    &:where(.rt-r-size-3) {
      --base-card-padding-top: var(--space-4);
      --base-card-padding-right: var(--space-4);
      --base-card-padding-bottom: var(--space-4);
      --base-card-padding-left: var(--space-4);
      --base-card-border-radius: min(var(--radius-7), calc(var(--radius-3) + var(--space-3)));
    }
    &:where(.rt-r-size-4) {
      --base-card-padding-top: var(--space-5);
      --base-card-padding-right: var(--space-5);
      --base-card-padding-bottom: var(--space-5);
      --base-card-padding-left: var(--space-5);
      --base-card-border-radius: min(var(--radius-8), calc(var(--radius-4) + var(--space-4)));
    }
    &:where(.rt-r-size-5) {
      --base-card-padding-top: var(--space-6);
      --base-card-padding-right: var(--space-6);
      --base-card-padding-bottom: var(--space-6);
      --base-card-padding-left: var(--space-6);
      --base-card-border-radius: min(var(--radius-9), calc(var(--radius-5) + var(--space-5)));
    }
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * INSET MODE                                                                                      *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where([data-inset='true']) {
  --base-card-padding-top: 0px;
  --base-card-padding-right: 0px;
  --base-card-padding-bottom: 0px;
  --base-card-padding-left: 0px;
}

/***************************************************************************************************
 *                                                                                                 *
 * VARIANT PALETTES                                                                                *
 *                                                                                                 *
 * Each variant defines its color variables. State logic is shared for outline, soft, surface.     *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where(.rt-variant-outline) {
  --card-border-width: 1px;
  --v-bg: transparent;
  --v-bg-a: transparent;
  --v-bg-hover: var(--gray-2);
  --v-bg-hover-a: var(--gray-a2);
  --v-bg-active: var(--gray-3);
  --v-bg-active-a: var(--gray-a3);
  --v-border: var(--gray-6);
  --v-border-a: var(--gray-a6);
  --v-border-hover: var(--gray-7);
  --v-border-hover-a: var(--gray-a7);
  --v-border-active: var(--gray-8);
  --v-border-active-a: var(--gray-a8);
  --v-focus-color: var(--focus-8);
  --v-focus-offset: -1px;
}

.rt-BaseCard:where(.rt-variant-soft) {
  --card-border-width: 0px;
  --v-bg: var(--gray-2);
  --v-bg-a: var(--gray-a2);
  --v-bg-hover: var(--gray-3);
  --v-bg-hover-a: var(--gray-a3);
  --v-bg-active: var(--gray-3);
  --v-bg-active-a: var(--gray-a3);
  --v-focus-color: var(--gray-8);
  --v-focus-offset: -1px;
}

.rt-BaseCard:where(.rt-variant-surface) {
  --card-border-width: 1px;
  --v-bg: var(--gray-1);
  --v-bg-a: var(--gray-a1);
  --v-bg-hover: var(--gray-2);
  --v-bg-hover-a: var(--gray-a2);
  --v-bg-active: var(--gray-3);
  --v-bg-active-a: var(--gray-a3);
  --v-border: var(--gray-6);
  --v-border-a: var(--gray-a6);
  --v-border-hover: var(--gray-7);
  --v-border-hover-a: var(--gray-a7);
  --v-border-active: var(--gray-7);
  --v-border-active-a: var(--gray-a7);
  --v-focus-color: var(--focus-8);
  --v-focus-offset: -1px;
}

/***************************************************************************************************
 *                                                                                                 *
 * SHARED STATE LOGIC: OUTLINE, SOFT, SURFACE                                                      *
 *                                                                                                 *
 * Single set of state selectors using palette variables.                                          *
 * Ghost is separate because it applies styles to element, not ::before.                           *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where(.rt-variant-outline, .rt-variant-soft, .rt-variant-surface) {
  /* Rest state */
  &::before {
    background-color: color-mix(
      in srgb,
      var(--v-bg-a) calc(var(--material-alpha) * 40%),
      var(--v-bg) var(--material-blend)
    );
  }

  /* Focus */
  &:where(:focus-visible) {
    outline: 2px solid var(--v-focus-color);
    outline-offset: var(--v-focus-offset);

    &::after {
      outline: inherit;
    }

    &:where(:active:not([data-state='open']))::before {
      background-image: linear-gradient(var(--focus-a2), var(--focus-a2));
    }
  }

  /* Interactive states */
  &:where(:any-link, button, label) {
    @media (hover: hover) {
      &:where(:hover)::before {
        background-color: color-mix(
          in srgb,
          var(--v-bg-hover-a) calc(var(--material-alpha) * 40%),
          var(--v-bg-hover) var(--material-blend)
        );
      }
    }

    &:where([data-state='open'])::before {
      background-color: color-mix(
        in srgb,
        var(--v-bg-hover-a) calc(var(--material-alpha) * 40%),
        var(--v-bg-hover) var(--material-blend)
      );
    }

    &:where(:active:not([data-state='open']))::before {
      background-color: color-mix(
        in srgb,
        var(--v-bg-active-a) calc(var(--material-alpha) * 40%),
        var(--v-bg-active) var(--material-blend)
      );
    }
  }

  /* Tap highlight */
  @media (pointer: coarse) {
    &:where(:any-link, button, label):where(:active:not([data-state='open']))::before {
      background-image: linear-gradient(var(--gray-a4), var(--gray-a4));
    }
  }
}

/* Soft variant ::after reset */
.rt-BaseCard:where(.rt-variant-soft)::after {
  box-shadow: none;
  border: none;
  outline: none;
}

/***************************************************************************************************
 *                                                                                                 *
 * BORDER VARIANTS: OUTLINE & SURFACE                                                              *
 *                                                                                                 *
 ***************************************************************************************************/

/* Outline uses direct box-shadow on element */
.rt-BaseCard:where(.rt-variant-outline) {
  box-shadow: inset 0 0 0 1px color-mix(
    in srgb,
    var(--v-border-a) calc(var(--material-alpha) * 40%),
    var(--v-border) var(--material-blend)
  );

  &::after {
    box-shadow: none;
  }

  &:where(:any-link, button, label) {
    @media (hover: hover) {
      &:where(:hover) {
        box-shadow: inset 0 0 0 1px color-mix(
          in srgb,
          var(--v-border-hover-a) calc(var(--material-alpha) * 40%),
          var(--v-border-hover) var(--material-blend)
        );
      }
    }

    &:where([data-state='open']) {
      box-shadow: inset 0 0 0 1px color-mix(
        in srgb,
        var(--v-border-hover-a) calc(var(--material-alpha) * 40%),
        var(--v-border-hover) var(--material-blend)
      );
    }

    &:where(:active:not([data-state='open'])) {
      box-shadow: inset 0 0 0 1px color-mix(
        in srgb,
        var(--v-border-active-a) calc(var(--material-alpha) * 40%),
        var(--v-border-active) var(--material-blend)
      );
    }
  }
}

/* Surface uses ::after for border ON TOP of children */
.rt-BaseCard:where(.rt-variant-surface)::after {
  box-shadow: inset 0 0 0 var(--base-card-border-width) color-mix(
    in srgb,
    var(--v-border-a) calc(var(--material-alpha) * 40%),
    var(--v-border) var(--material-blend)
  );
}

.rt-BaseCard:where(.rt-variant-surface):where(:any-link, button, label) {
  @media (hover: hover) {
    &:where(:hover)::after {
      box-shadow: inset 0 0 0 var(--base-card-border-width) color-mix(
        in srgb,
        var(--v-border-hover-a) calc(var(--material-alpha) * 40%),
        var(--v-border-hover) var(--material-blend)
      );
    }
  }

  &:where([data-state='open'])::after,
  &:where(:active:not([data-state='open']))::after {
    box-shadow: inset 0 0 0 var(--base-card-border-width) color-mix(
      in srgb,
      var(--v-border-active-a) calc(var(--material-alpha) * 40%),
      var(--v-border-active) var(--material-blend)
    );
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * GHOST VARIANT                                                                                   *
 *                                                                                                 *
 * Ghost applies styles directly to the element (not ::before) for different visual behavior.      *
 * Backdrop-filter is on the element itself, not the pseudo-element.                               *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where(.rt-variant-ghost) {
  --card-border-width: 0px;
  --v-bg-hover: var(--gray-3);
  --v-bg-hover-a: var(--gray-a3);
  --v-bg-active: var(--gray-4);
  --v-bg-active-a: var(--gray-a4);
  --v-focus-color: var(--focus-8);
  --v-focus-offset: -1px;

  /* Flush mode */
  &:where([data-flush='true']) {
    --margin-top: 0px;
    --margin-right: 0px;
    --margin-bottom: 0px;
    --margin-left: 0px;
    --margin-top-override: calc(var(--margin-top) - var(--card-padding));
    --margin-right-override: calc(var(--margin-right) - var(--card-padding));
    --margin-bottom-override: calc(var(--margin-bottom) - var(--card-padding));
    --margin-left-override: calc(var(--margin-left) - var(--card-padding));

    margin-top: var(--margin-top-override);
    margin-right: var(--margin-right-override);
    margin-bottom: var(--margin-bottom-override);
    margin-left: var(--margin-left-override);

    :where(&) > * {
      --margin-top-override: initial;
      --margin-right-override: initial;
      --margin-bottom-override: initial;
      --margin-left-override: initial;
    }
  }

  /* Focus */
  &:where(:focus-visible) {
    outline: 2px solid var(--v-focus-color);
    outline-offset: var(--v-focus-offset);
  }

  /* Backdrop-filter handling for ghost - on element, not ::before */
  :where([data-panel-background='translucent'], [data-material='translucent']) & {
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
  }

  &:where([data-panel-background='solid'], [data-material='solid']) {
    backdrop-filter: none;
  }

  &:where([data-panel-background='translucent'], [data-material='translucent']) {
    backdrop-filter: var(--backdrop-filter-panel);
    --backdrop-filter-panel: blur(var(--backdrop-blur-panel));
  }

  /* Interactive states - background on element, not ::before */
  &:where(:any-link, button, label) {
    @media (hover: hover) {
      &:where(:hover) {
        background-color: color-mix(
          in srgb,
          var(--v-bg-hover-a) calc(var(--material-alpha) * 40%),
          var(--v-bg-hover) var(--material-blend)
        );

        &:where(:focus-visible) {
          background-color: var(--focus-a2);
        }
      }
    }

    &:where([data-state='open']) {
      background-color: color-mix(
        in srgb,
        var(--v-bg-hover-a) calc(var(--material-alpha) * 40%),
        var(--v-bg-hover) var(--material-blend)
      );

      &:where(:focus-visible) {
        background-color: var(--focus-a2);
      }
    }

    &:where(:active:not([data-state='open'])) {
      background-color: color-mix(
        in srgb,
        var(--v-bg-active-a) calc(var(--material-alpha) * 40%),
        var(--v-bg-active) var(--material-blend)
      );

      &:where(:focus-visible) {
        background-color: var(--focus-a2);
      }
    }
  }

  /* Tap highlight */
  @media (pointer: coarse) {
    &:where(:any-link, button, label):where(:active:not([data-state='open']))::before {
      background-image: linear-gradient(var(--gray-a4), var(--gray-a4));
    }
  }

  /* Prevent backdrop-filter stacking inside overlay components */
  :where(
    .rt-PopoverContent,
    .rt-BaseDialogContent,
    .rt-BaseMenuContent,
    .rt-DropdownMenuContent,
    .rt-ContextMenuContent,
    .rt-AlertDialogContent,
    .rt-HoverCardContent,
    .rt-TooltipContent,
    .rt-Card
  ) & {
    backdrop-filter: none !important;
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * CLASSIC VARIANT                                                                                 *
 *                                                                                                 *
 * Uses elevation and surface colors - separate due to unique behavior                             *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where(.rt-variant-classic) {
  --card-border-width: 1px;
  --card-background-color: var(--color-surface-solid);
  position: relative;
  top: var(--classic-elevation-offset);
  box-shadow: var(--shadow-2);

  :where([data-panel-background='translucent'], [data-material='translucent']) & {
    --card-background-color: var(--color-surface-translucent);
  }

  &:where([data-panel-background='solid'], [data-material='solid']) {
    --card-background-color: var(--color-surface-solid);
  }

  &:where([data-panel-background='translucent'], [data-material='translucent']) {
    --card-background-color: var(--color-surface-translucent);
  }

  &::before {
    background-color: var(--card-background-color);
  }

  &::after {
    box-shadow: none;
  }

  &:where(:focus-visible) {
    outline: 2px solid var(--focus-8);
    outline-offset: 2px;
  }

  &:where(:any-link, button, label) {
    @media (hover: hover) {
      &:where(:hover) {
        box-shadow: var(--shadow-2);

        &::before {
          background-color: color-mix(
            in srgb,
            var(--gray-a2) calc(var(--material-alpha) * 40%),
            var(--gray-2) var(--material-blend)
          );
        }

        &::after {
          box-shadow: none;
        }
      }
    }

    &:where([data-state='open']) {
      &::before {
        background-color: color-mix(
          in srgb,
          var(--gray-a3) calc(var(--material-alpha) * 40%),
          var(--gray-3) var(--material-blend)
        );
      }

      &::after {
        box-shadow: none;
      }
    }

    &:where(:active:not([data-state='open'])) {
      &::before {
        background-color: color-mix(
          in srgb,
          var(--gray-a3) calc(var(--material-alpha) * 40%),
          var(--gray-3) var(--material-blend)
        );
      }

      &::after {
        box-shadow: none;
      }
    }
  }

  @media (pointer: coarse) {
    &:where(:any-link, button, label):where(:active:not([data-state='open']))::before {
      background-image: linear-gradient(var(--gray-a4), var(--gray-a4));
    }
  }
}

/***************************************************************************************************
 *                                                                                                 *
 * GLOBAL TAP HIGHLIGHT                                                                            *
 *                                                                                                 *
 ***************************************************************************************************/

.rt-BaseCard:where(:any-link, button, label) {
  @media (pointer: coarse) {
    &:where(:active:not(:focus-visible, [data-state='open']))::before {
      background-image: linear-gradient(var(--gray-a4), var(--gray-a4));
    }
  }
}
