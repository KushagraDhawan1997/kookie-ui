import { Table, Text, Code, Box, Callout, Flex, Button, IconButton, Card, Image, Theme, Badge, Section, Separator, Heading, Grid } from '@kushagradhawan/kookie-ui';
import { MessageSquare, Paperclip, Send, Users, Zap, Eye, Hand, Brain, Target } from 'lucide-react';
import { CodeBlock } from '../../../components/code-block';

<Section size="1">

# Guidelines

Psychology, hierarchy, and design principles for effective chat interfaces. These guidelines help you create intuitive, accessible, and engaging messaging experiences that feel natural and responsive to users.

</Section>

<Separator size="4"/>

<Section size="1">

## Core Principles

### 1. Conversational Flow

Chat interfaces should feel like natural conversations. The Chatbar component is designed to support this flow by providing:

- **Immediate feedback**: Visual responses to user actions
- **Contextual expansion**: Growing when needed, staying compact when not
- **Natural input patterns**: Supporting both text and media seamlessly

<Callout.Root variant="surface" size="2" color="blue" my="6">
  <Callout.Text>Think of the chatbar as a conversation partner that adapts to the context and needs of the user.</Callout.Text>
</Callout.Root>

### 2. Progressive Disclosure

The chatbar uses progressive disclosure to reveal functionality as needed:

- **Compact state**: Shows essential actions (attach, send)
- **Expanded state**: Reveals full input area and additional controls
- **Contextual triggers**: Expands based on focus, content, or user intent

### 3. Accessibility First

Every interaction should be accessible to all users:

- **Keyboard navigation**: Full keyboard support for all functions
- **Screen reader support**: Proper ARIA labels and announcements
- **Visual clarity**: High contrast and clear visual hierarchy
- **Reduced motion**: Respects user preferences for motion

</Section>

<Separator size="4"/>

<Section size="1">

## Visual Hierarchy

### Size and Spacing

<Grid columns={{ initial: '1', md: '2' }} gap="4" my="6">
  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">Compact State</Heading>
      <Text size="2" color="gray">
        Use compact state for:
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Quick messages</Text>
        <Text size="2" as="li">Mobile interfaces</Text>
        <Text size="2" as="li">Space-constrained layouts</Text>
        <Text size="2" as="li">Frequent, short interactions</Text>
      </Box>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">Expanded State</Heading>
      <Text size="2" color="gray">
        Use expanded state for:
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Longer messages</Text>
        <Text size="2" as="li">Desktop interfaces</Text>
        <Text size="2" as="li">Rich content creation</Text>
        <Text size="2" as="li">Complex conversations</Text>
      </Box>
    </Flex>
  </Card>
</Grid>

### Color and Contrast

<Box>
  <Table.Root mt="6" mb="6" size="2" variant="ghost">
    <Table.Header>
      <Table.Row>
        <Table.ColumnHeaderCell>Element</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Contrast Ratio</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Purpose</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Guidance</Table.ColumnHeaderCell>
      </Table.Row>
    </Table.Header>
    <Table.Body>
      <Table.Row>
        <Table.RowHeaderCell>Text Input</Table.RowHeaderCell>
        <Table.Cell>`4.5:1`</Table.Cell>
        <Table.Cell>Readability</Table.Cell>
        <Table.Cell>Ensure text is clearly readable</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Placeholder</Table.RowHeaderCell>
        <Table.Cell>`3:1`</Table.Cell>
        <Table.Cell>Guidance</Table.Cell>
        <Table.Cell>Distinguishable but secondary</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Buttons</Table.RowHeaderCell>
        <Table.Cell>`4.5:1`</Table.Cell>
        <Table.Cell>Action</Table.Cell>
        <Table.Cell>Clear call-to-action visibility</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Focus Ring</Table.RowHeaderCell>
        <Table.Cell>`3:1`</Table.Cell>
        <Table.Cell>Navigation</Table.Cell>
        <Table.Cell>Clear focus indication</Table.Cell>
      </Table.Row>
    </Table.Body>
  </Table.Root>
</Box>

</Section>

<Separator size="4"/>

<Section size="1">

## Interaction Patterns

### Expansion Behavior

The chatbar supports four expansion modes, each suited for different use cases:

<Grid columns={{ initial: '1', md: '2' }} gap="4" my="6">
  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">`none`</Heading>
      <Text size="2" color="gray">
        Manual expansion only
      </Text>
      <Text size="2">
        Use when you want complete control over when the chatbar expands. Good for interfaces where space is at a premium.
      </Text>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">`focus`</Heading>
      <Text size="2" color="gray">
        Expands on focus
      </Text>
      <Text size="2">
        Expands when the user focuses the input. Good for interfaces where the chatbar is always visible.
      </Text>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">`overflow`</Heading>
      <Text size="2" color="gray">
        Expands on content overflow
      </Text>
      <Text size="2">
        Expands when content exceeds the compact height. Good for interfaces where users might type longer messages.
      </Text>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">`both`</Heading>
      <Text size="2" color="gray">
        Expands on focus or overflow
      </Text>
      <Text size="2">
        Combines focus and overflow behavior. Good for most general-purpose chat interfaces.
      </Text>
    </Flex>
  </Card>
</Grid>

### Send Button Behavior

The send button supports three visibility modes:

<Box>
  <Table.Root mt="6" mb="6" size="2" variant="ghost">
    <Table.Header>
      <Table.Row>
        <Table.ColumnHeaderCell>Mode</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Visibility</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Use Case</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Guidance</Table.ColumnHeaderCell>
      </Table.Row>
    </Table.Header>
    <Table.Body>
      <Table.Row>
        <Table.RowHeaderCell>`always`</Table.RowHeaderCell>
        <Table.Cell>Always visible</Table.Cell>
        <Table.Cell>Simple interfaces</Table.Cell>
        <Table.Cell>Use when the send action is always available</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>`whenDirty`</Table.RowHeaderCell>
        <Table.Cell>When content exists</Table.Cell>
        <Table.Cell>Most chat interfaces</Table.Cell>
        <Table.Cell>Shows send button when there's content to send</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>`never`</Table.RowHeaderCell>
        <Table.Cell>Never visible</Table.Cell>
        <Table.Cell>Custom implementations</Table.Cell>
        <Table.Cell>Use when you handle submission differently</Table.Cell>
      </Table.Row>
    </Table.Body>
  </Table.Root>
</Box>

</Section>

<Separator size="4"/>

<Section size="1">

## File Handling Guidelines

### Attachment Best Practices

<Grid columns={{ initial: '1', md: '2' }} gap="4" my="6">
  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">File Types</Heading>
      <Text size="2" color="gray">
        Choose appropriate file types for your use case
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Images: `image/*` for photos and graphics</Text>
        <Text size="2" as="li">Documents: `.pdf,.doc,.docx` for files</Text>
        <Text size="2" as="li">Media: `audio/*,video/*` for rich content</Text>
        <Text size="2" as="li">Code: `.js,.ts,.py` for development</Text>
      </Box>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">Size Limits</Heading>
      <Text size="2" color="gray">
        Set reasonable size limits
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Images: 5-10MB max</Text>
        <Text size="2" as="li">Documents: 25MB max</Text>
        <Text size="2" as="li">Media: 100MB max</Text>
        <Text size="2" as="li">Code: 1MB max</Text>
      </Box>
    </Flex>
  </Card>
</Grid>

### User Feedback

<Callout.Root variant="surface" size="2" color="green" my="6">
  <Callout.Text>Always provide clear feedback when files are rejected. Explain why and suggest alternatives when possible.</Callout.Text>
</Callout.Root>

<CodeBlock>

```tsx
<Chatbar.Root 
  maxFileSize={5 * 1024 * 1024} // 5MB
  onAttachmentReject={(rejections) => {
    rejections.forEach(({ file, reason }) => {
      if (reason === 'size') {
        toast.error(`${file.name} is too large. Maximum size is 5MB.`);
      } else if (reason === 'type') {
        toast.error(`${file.name} is not a supported file type.`);
      } else if (reason === 'count') {
        toast.error('Maximum number of attachments reached.');
      }
    });
  }}
>
  {/* ... */}
</Chatbar.Root>
```

</CodeBlock>

</Section>

<Separator size="4"/>

<Section size="1">

## Accessibility Guidelines

### Screen Reader Support

<Box>
  <Table.Root mt="6" mb="6" size="2" variant="ghost">
    <Table.Header>
      <Table.Row>
        <Table.ColumnHeaderCell>Element</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>ARIA Label</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Description</Table.ColumnHeaderCell>
        <Table.ColumnHeaderCell>Required</Table.ColumnHeaderCell>
      </Table.Row>
    </Table.Header>
    <Table.Body>
      <Table.Row>
        <Table.RowHeaderCell>Textarea</Table.RowHeaderCell>
        <Table.Cell>`aria-label` or `aria-labelledby`</Table.Cell>
        <Table.Cell>Describes the input purpose</Table.Cell>
        <Table.Cell>Yes</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Attach Button</Table.RowHeaderCell>
        <Table.Cell>`aria-label="Add attachments"`</Table.Cell>
        <Table.Cell>Describes the attach action</Table.Cell>
        <Table.Cell>No (has default)</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Send Button</Table.RowHeaderCell>
        <Table.Cell>`aria-label="Send"`</Table.Cell>
        <Table.Cell>Describes the send action</Table.Cell>
        <Table.Cell>No (has default)</Table.Cell>
      </Table.Row>
      <Table.Row>
        <Table.RowHeaderCell>Attachments</Table.RowHeaderCell>
        <Table.Cell>`role="list"` and `aria-label`</Table.Cell>
        <Table.Cell>Describes the attachments list</Table.Cell>
        <Table.Cell>No (has default)</Table.Cell>
      </Table.Row>
    </Table.Body>
  </Table.Root>
</Box>

### Keyboard Navigation

<CodeBlock>

```tsx
// Keyboard shortcuts
Tab          // Move between interactive elements
Enter        // Submit (when submitOnEnter is true)
Shift+Enter  // Insert newline
Escape       // Cancel/close (if implemented)
Space        // Activate buttons
```

</CodeBlock>

### Focus Management

<Callout.Root variant="surface" size="2" color="orange" my="6">
  <Callout.Text>When the chatbar expands, ensure the textarea receives focus to maintain keyboard navigation flow.</Callout.Text>
</Callout.Root>

</Section>

<Separator size="4"/>

<Section size="1">

## Performance Considerations

### File Handling

<Grid columns={{ initial: '1', md: '2' }} gap="4" my="6">
  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">Image Previews</Heading>
      <Text size="2" color="gray">
        Optimize image previews for performance
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Use object URLs for previews</Text>
        <Text size="2" as="li">Clean up URLs when attachments are removed</Text>
        <Text size="2" as="li">Limit preview size to reasonable dimensions</Text>
        <Text size="2" as="li">Consider lazy loading for many attachments</Text>
      </Box>
    </Flex>
  </Card>

  <Card size="2" variant="soft">
    <Flex direction="column" gap="3">
      <Heading size="3">Memory Management</Heading>
      <Text size="2" color="gray">
        Prevent memory leaks
      </Text>
      <Box as="ul" pl="4">
        <Text size="2" as="li">Revoke object URLs on cleanup</Text>
        <Text size="2" as="li">Limit maximum attachments</Text>
        <Text size="2" as="li">Clear attachments after submission</Text>
        <Text size="2" as="li">Use proper cleanup in useEffect</Text>
      </Box>
    </Flex>
  </Card>
</Grid>

### Auto-resize Performance

<Callout.Root variant="surface" size="2" color="blue" my="6">
  <Callout.Text>The chatbar uses optimized auto-resize logic that minimizes layout recalculations and provides smooth animations.</Callout.Text>
</Callout.Root>

</Section>

<Separator size="4"/>

<Section size="1">

## Common Patterns

### Basic Chat Interface

<CodeBlock>

```tsx
<Chatbar.Root 
  onSubmit={({ value, attachments }) => {
    // Send message
    sendMessage({ text: value, files: attachments });
  }}
>
  <Chatbar.Textarea 
    placeholder="Type a message..."
    aria-label="Message input"
  />
  <Chatbar.AttachTrigger />
  <Chatbar.Send />
</Chatbar.Root>
```

</CodeBlock>

### Rich Media Chat

<CodeBlock>

```tsx
<Chatbar.Root 
  accept="image/*,video/*,audio/*"
  maxFileSize={10 * 1024 * 1024} // 10MB
  maxAttachments={5}
  onSubmit={({ value, attachments }) => {
    // Send rich message
    sendMessage({ 
      text: value, 
      media: attachments.map(a => a.file) 
    });
  }}
>
  <Chatbar.AttachmentsRow />
  <Chatbar.Textarea 
    placeholder="Share your thoughts..."
    aria-label="Message input"
  />
  <Chatbar.AttachTrigger />
  <Chatbar.Send />
</Chatbar.Root>
```

</CodeBlock>

### Mobile-First Design

<CodeBlock>

```tsx
<Chatbar.Root 
  size="1" // Smaller size for mobile
  expandOn="focus" // Expand on focus for mobile
  onSubmit={({ value, attachments }) => {
    // Send message
  }}
>
  <Chatbar.Textarea 
    placeholder="Message..."
    aria-label="Message input"
  />
  <Chatbar.AttachTrigger />
  <Chatbar.Send />
</Chatbar.Root>
```

</CodeBlock>

</Section>